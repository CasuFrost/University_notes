\documentclass[12pt, letterpaper]{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{hyperref}
\usepackage{listings}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage[english]{babel}
\usepackage{nicefrac, xfrac}
\usepackage{mathtools}
\newcommand{\acc}{\\\hphantom{}\\}
\usepackage[table,xcdraw]{xcolor}
\definecolor{light-gray}{gray}{0.95}
\newcommand{\code}[1]{\colorbox{light-gray}{\texttt{#1}}}
\usepackage[paper=a4paper,left=20mm,right=20mm,bottom=25mm,top=25mm]{geometry}
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}}
\renewcommand{\labelenumiii}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}}
\renewcommand{\labelenumiv}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.\arabic{enumiv}}
\title{\textbf{Travel to the moon}}

\date{}


\begin{document}

\maketitle


\section{Requisiti}
I dati di interesse per il sistema sono \acc
1. Requisiti sulle \textbf{crociere}:\\
\hphantom{ident}1.1. codice \\
\hphantom{ident}1.2. data di inizio\\
\hphantom{ident}1.3. data di fine\\
\hphantom{ident}1.4. nave utilizzata (v. req. 2)\\
\hphantom{ident}1.5. itinerario (v. req. 4)\\
\hphantom{ident}1.6. il tipo, uno tra:\\
\hphantom{ident}\hphantom{ident}1.6.1. luna di miele, di cui interessa:\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}1.6.1.1. sottotipo, uno tra:\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}\hphantom{ident}1.6.1.1.1. tradizionali\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}\hphantom{ident}1.6.1.1.2. alternative\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}1.6.2. per famiglie, di cui interessa:\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}\hphantom{ident}1.6.3. se adatte ai bambini (booleano)
\acc
2. Requisiti sulle \textbf{navi}:\\
\hphantom{ident}2.1. nome\\
\hphantom{ident}2.2. comfort (3..5)\\
\hphantom{ident}2.3. capienza
\acc
3. Requisiti sulle \textbf{destinazioni}:\\
\hphantom{ident}3.1. nome\\
\hphantom{ident}3.2. continente\\
\hphantom{ident}3.3. posti da vedere (v. req. 5)\\
\hphantom{ident}3.4. tipo, almeno uno tra:\\
\hphantom{ident}\hphantom{ident}3.4.1. romantico\\
\hphantom{ident}\hphantom{ident}3.4.2. divertente
\acc
4. Requisiti sugli \textbf{itinerari}:\\
\hphantom{ident}4.1. sequenza ordinata di elementi, di cui interessa:\\
\hphantom{ident}\hphantom{ident}4.1.1. porto (v. req. 3)\\
\hphantom{ident}\hphantom{ident}4.1.2. arrivo:\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}4.1.2.1. il numero d'ordine del giorno (rispetto alla data di inizio della crociera)\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}4.1.2.2. ora\\
\hphantom{ident}\hphantom{ident}4.1.3. ripartenza	\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}4.1.3.1. il numero d'ordine del giorno (rispetto alla data di inizio della crociera)\\
\hphantom{ident}\hphantom{ident}\hphantom{ident}4.1.3.2. ora
\acc
5. Requisiti sui \textbf{posti da vedere}:\\
\hphantom{ident}5.1. nome\\
\hphantom{ident}5.2. descrizione\\
\hphantom{ident}5.3. orari di apertura, nella forma di una mappa che associa ad ogni giorno della settimana\\
\hphantom{ident}\hphantom{ident}(lunedì, ..., domenica) un insieme di fasce orarie, dove ogni fascia oraria\\
\hphantom{ident}\hphantom{ident}è definita in termini di una coppia di orari\acc
6. Requisiti sulle \textbf{prenotazioni}:\\
\hphantom{ident}6.1 data ed ora della prenotazione.\\
\hphantom{ident}6.2 cliente coinvolto.\\
\hphantom{ident}6.3 crociera coinvolta\\
\hphantom{ident}6.4 numero posti prenotati\acc
7. Requisiti sui \textbf{clienti}:\\
\hphantom{ident}7.1 nome.\\
\hphantom{ident}7.2 cognome.\\
\hphantom{ident}7.3 data di nascita.\\
\hphantom{ident}7.4 indirizzo.
\newpage
\section{UML}\begin{center}

    \includegraphics[width=\textwidth]{images/UML.eps}
\end{center}
\newpage
\section{Use Case}\begin{center}

    \includegraphics[width=\textwidth]{images/UseCase.eps}
\end{center}
\newpage
\section{Specifiche}
\subsection{Specifica dei Tipi di Dato}
Indirizzo = \{   via:Stringa,   civico  :  Intero$>$0,    CAP : Intero$>$0  \}\acc
GiornoSettimana = \{Lunedì...,Domenica\}\acc
FasciaOraria = (inizio\_fascia : Ora, fine\_fascia : Ora)\acc 
TipoDestinazione = {romantica, divertente}\acc
DeltaDataOra = (\\
\hphantom{ident}giorno: Intero $>$ 0,\\
\hphantom{ident}orario: Ora	\\
)\acc
Operazioni del tipo di dato DeltaDataOra:\acc
\hphantom{ident}$<$ (x:DeltaDataOra, y:DeltaDataOra) : Boolano\\
\hphantom{ident}\hphantom{ident}pre: nessuna\\
\hphantom{ident}\hphantom{ident}postcondizioni:\\
\hphantom{ident}\hphantom{ident}result = true se e solo se:\\
\hphantom{ident}\hphantom{ident}(x.giorno $<$ y.giorno)\\
\hphantom{ident}\hphantom{ident}oppure\\
\hphantom{ident}\hphantom{ident}(x.giorno = y.giorno e x.orario $<$ y.orario)
\subsection{Specifica delle Classi}
\subsubsection{Crociera}
Operazione \code{posti\_liberi () : Intero $\ge$ 0}\begin{itemize}
    \item \textit{pre-condizioni} : L'oggetto \textit{this} deve essere coinvolto in almeno un link di 
    tipo croc\_nave con un oggetto di tipo Nave.
    \item \textit{post-condizioni} : Sia $P$ l'insieme delle prenotazioni p:Prenotazione tale che 
    $\exists$ un link di tipo croc\_pren con \textit{this}. Sia
     $n=\displaystyle\sum_{p\in P}p.\text{postiPrenotati}$, sia b:Nave l'oggetto di tipo Nave 
     per il quale esiste il link (this,b) di tipo croc\_nave. result = b.capienza-$n$.
\end{itemize}
Operazione \code{fine() : Data}\begin{itemize}
    \item \textit{pre-condizioni} : nessuna
    \item \textit{post-condizioni} : Sia i:Itinerario tale che (this, i):croc\_itin.\acc
          Sia x:DeltaDataOra il valore dell'attributo "istante" dell'unico link di assoc.
          arrivo\_itin in cui "i" è coinvolto.\acc
          result = this.inizio + x.giorno "giorni".
\end{itemize}
\textbf{Vincoli esterni} :\acc
$[$V.Crociera.date$]$\\
\hphantom{ident}Per ogni oggetto c:Crociera deve essere: c.inizio $\le$ c.fine\acc
\subsubsection{Itinerario}
\textbf{Vincoli esterni} :\acc
$[$V.Itinerario.arrivo\_dopo\_ultima\_tappa$]$\\
\hphantom{ident}Per ogni i:Itinerario siano: \begin{itemize}
    \item  T l'insieme delle istanze 't' di classe Tappa tali che (i,t):itin\_tappa
    \item x il valore dell'attributo 'istante' dell'unico link di associazione arrivo\_itin in cui 'i' è coinvolto
\end{itemize}
\hphantom{ident}Per ogni t:T, deve essere: t.ripartenza $<$ x.\acc
$[$V.Itinerario.prima\_tappa\_dopo\_partenza$]$\\
\hphantom{ident}Per ogni i:Itinerario siano: \begin{itemize}
    \item  T l'insieme delle istanze 't' di classe Tappa tali che (i,t):itin\_tappa e t.arrivo.giorno = 1
    \item  x il valore dell'attributo 'istante' dell'unico link di associazione partenza\_itin in cui 'i' è coinvolto
\end{itemize}
\hphantom{ident}Per ogni t:T, deve essere t.arrivo.orario $>$ x.\acc
$[$V.Itinerario.arrivo\_dopo\_partenza\_se\_senza\_tappe$]$\\
\hphantom{ident}Per ogni i:Itinerario tale siano:  \begin{itemize}
    \item T l'insieme delle istanze 't' di classe Tappa tali che (i,t):itin\_tappa
    \item x il valore dell'attributo 'istante' dell'unico link di associazione partenza\_itin in cui 'i' è coinvolto
    \item y il valore dell'attributo 'istante' dell'unico link di associazione arrivo\_itin in cui 'i' è coinvolto

\end{itemize}
\hphantom{ident}se T = vuoto e y.giorno = 1, allora deve essere x $<$ y.orario.\\
\hphantom{ident}Per ogni t:T, deve essere t.arrivo.orario $>$ x.
\subsubsection{Tappa}
Operazione \code{n\_ordine() : Int $>$ 0}\begin{itemize}
    \item \textit{pre-condizioni} : nessuna
    \item \textit{post-condizioni} : No side-effect.
          Sia i l'itinerario della tappa this;
          Sia TappePrecedenti l'insieme degli oggetti t:Tappa tali che:\begin{itemize}
              \item  (i,t): itin\_tappa\\
              \item  t.arrivo $<$ this.arrivo;\end{itemize}
          result = $|$TappePrecedenti$|$ + 1.
\end{itemize}
\textbf{Vincoli esterni} :\acc
$[$V.Tappa.date$]$\\
\hphantom{ident}Per ogni istanza t:Tappa, deve essere:
t.arrivo $<$ t.ripartenza
\subsubsection{Prenotazioni}
\textbf{Vincoli esterni} :\acc
$[$V.Prenotazioni.date$]$\\
\hphantom{ident} Per ogni istanza p:Prenotazione, ed ogni link $r$ fra p:Prenotazione e c:Crociera, deve\\
\hphantom{ident} essere:
p.data\_prenotazione$<$c.indirizzo 
\subsubsection{Fascia Oraria}
$[$V.FasciaOraria.inizio\_fascia\_fine\_fascia$]$\\
\hphantom{ident} Per ogni f:FasciaOraria, f.fascia.inizio\_fascia $<$ f.fascia.fine\_fascia\acc 
$[$V.FasciaOraria.sovrapposizione\_fasce$]$\\
\hphantom{ident} Per ogni f:FasciaOraria con  $|$f.fascia$|$ $>$ 1 , presi f.fascia = x e f.fascia' = y 
, non esiste \hphantom{ident} y tale che:
(x.inizio\_fascia $\le$ y.inizio\_fascia $<$ x.fine\_fascia)
\subsection{Specifica degli Use-Case}
\subsubsection{Prenotazione}
Operazione\\ \code{effettua\_prenotazione (cl:Cliente, cr:Crociera, nPosti : Intero>0) : Prenotazione} \begin{itemize}
    \item \textit{pre-condizioni} : cr.Inizio $>$ now $\land$  nPosti $\le$ cr.posti\_liberi(). 
    \item \textit{post-condizioni} : Crea oggetto $p:Prenotazione$ tale che:\begin{itemize}
        \item $p$.istante = now 
        \item $p$.postiPrenotati = nPosti
    
    \item Viene creato un link di tipo croc\_pren fra cr e $p$\item Viene creato un link di tipo prenota fra $p$ e cl.
\end{itemize}
result = $p$
\end{itemize}
\subsubsection{Statistiche Azienda}
Operazione
\code{media\_dest\_esotica($d_i:Data, d_f:Data$) : Reale}
\begin{quote}
    pre: nessuno

post: Sia $\mathcal{C}$ l'insieme formato da ogni $c:Crociera$ tale che $\exists (p,c)$ con $p:Prenotazione$ e $d_i \le p.istante\le d_f$.\\
Sia $\mathcal{M}$ l'insieme contente le $ c\in\mathcal{C}$ tali che $\exists$ $i:Itinerario,d:Destinazione,t:Tappa$ con
$[(c,i)\wedge(i,d)]\vee[(c,i)\wedge(i,t)\wedge(t,d)] $  e  $cont:Continente|(d,cont)\wedge cont.nome \neq "Europa"$.

Se $\mathcal{M}\neq\emptyset\Rightarrow\mathcal{P}:=\{ c:Cliente | \exists (m,p)\wedge(p,c)$ con $m\in\mathcal{M}$ e $p:Prenotazione\}$ .\\

$$result = (\sum_{c\in\mathcal{P}}now - c.data\_nascita)/|\mathcal{P}|$$

altrimenti $result = -1$\\

\hfill{}\textit{ Con $(\alpha,\beta)\longrightarrow$ link tra $\alpha$ e $\beta$.}
\end{quote}
Operazione
\code{percentuale\_gettonate($d_i:Data, d_f:Data$): Reale}
\begin{quote}
    pre: nessuna
    
    post: Sia $\mathcal{L}:= \{l:LunaDiMiele | \quad d_i\le l.inizio\le d_f \}$ e\\ $
    \mathcal{F}:= \{f:PerFamiglie | \quad d_i\le f.inizio\le d_f \}$.\\
    Sia $\varphi(x):=$ proprietà di $x:Destinazione$ vera $\Leftrightarrow\exists$ almeno 10 link del tipo 
    : $(x,i)^*\wedge(i,l)$ oppure almeno 15 del tipo: $(x,i)^*\wedge(i,f)$ con $i:Itinerario$,$l\in\mathcal{L}$ e $f\in\mathcal{F}$.\\

    Consideriamo $\mathcal{D}$ l'insieme di tutte le destinazioni raggiunte tra $d_i$ e $d_f$, $\mathcal{D}'$ l'insieme di tutte le destinazioni per cui è vera $\varphi(x)$.\\
    $$result = \frac{|\mathcal{D}'|}{|\mathcal{D}|}\cdot 100$$\\

\hfill{}\textit{Con $(x,i)^*\rightarrow[(x,i)\vee((x,t)\wedge(t,i))]$} 


\end{quote}
\end{document}
























Operazione : \code{etàMediaEsot(leftBound : Data, rightBound : Data) : Reale}\begin{itemize}
    \item \textit{pre-condizioni} : leftBound $<$ rightBound.
    \item \textit{post-condizioni} : Si consideri $P_1$ l'insieme delle prenotazioni p:Prenotazione tale
          che leftBound $\le$ p.istante $le$ rightBound.\acc
          Si consideri $P_2$ l'insieme delle prenotazioni p:Prenotazione, per cui, vi è almeno un link (p,c) con c:Crociera, per cui
          tale crociera è coinvolta in almeno un link (c,i) con i:Itinerario, per cui tale itinerario è coinvolto in almeno un
          link (i,d) con d:Destinazione, per cui tale destinazione è coinvolta in almeno un link (d,c) con c:Continente, per cui
          c.Stringa $\ne$ "Europa".\acc
          Si consideri $P_1\cap P_2$, si consideri $C$ l'insieme dei clienti c:Cliente per cui esiste un link (c,p) dove
          p$\in P$. Si consideri $n=\displaystyle \sum_{c\in C}c.\text{età}$.
          result = $\dfrac{n}{|C|}$.
\end{itemize}
Operazione : \code{destGett(leftBound : Data, rightBound : Data) : Reale}\begin{itemize}
    \item \textit{pre-condizioni} : leftBound $<$ rightBound. Esiste almeno un oggetto di tipo p:Prenotazione
          per cui leftBound $\le$ p.istante $le$ rightBound.
    \item \textit{post-condizioni} : Sia $P$ l'insieme delle prenotazioni p:Prenotazione tale
          che leftBound $\le$ p.istante $\le$ rightBound.
\end{itemize}

\subsubsection{Cliente}
Operazione : \code{prenota( posti:Intero $>$ 0, c:Crociera)}\begin{itemize}
    \item \textit{pre-condizioni} : sia $R$ l'insieme delle relazioni (c,$p$) dove
          $p$:Prenotazione coinvolta con c:Crociera. Considero $n=\displaystyle\sum_{(\text{c},p_i)\in R}p_i.\text{postiPrenotati}$.\acc
          sia (c,nave) il link di tipo croc\_nave e sia nave:Nave, considero $free=\text{nave.capienza}-n$ (i posti liberi). \acc
          Deve essere che posti$\le$ $free$.
    \item \textit{post-condizioni} : Viene creato un oggetto p:Prenotazione in relazione con this ed in relazione con
          c:Crociera (parametro in input), sarà che : p.istante=now, p.postiPrenotati=posti, p.codicePren=Stringa univoca randomica.
\end{itemize}


